<macros>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="3.8.13">python</requirement>
            <requirement type="package" version="1.79">biopython</requirement>
            <requirement type="package" version="1.2.2">cpt_gffparser</requirement>
            <yield/>
        </requirements>
    </xml>
    <token name="@BLAST_TSV@">
		"$blast_tsv"
	</token>
    <xml name="blast_tsv">
        <param label="Blast Results" help="TSV/tabular (25 Column)" name="blast_tsv" type="data" format="tabular"/>
    </xml>
    <token name="@BLAST_XML@">
		"$blast_xml"
	</token>
    <xml name="blast_xml">
        <param label="Blast Results" help="XML format" name="blast_xml" type="data" format="blastxml"/>
    </xml>
    <xml name="gff3_with_fasta">
        <param label="Genome Sequences" name="fasta" type="data" format="fasta"/>
        <param label="Genome Annotations" name="gff3" type="data" format="gff3"/>
    </xml>
    <xml name="genome_selector">
        <conditional name="reference_genome">
            <param name="reference_genome_source" type="select" label="Reference Genome">
                <option value="history" selected="True">From History</option>
                <option value="cached">Locally Cached</option>
            </param>
            <when value="cached">
                <param name="fasta_indexes" type="select" label="Source FASTA Sequence">
                    <options from_data_table="all_fasta"/>
                </param>
            </when>
            <when value="history">
                <param name="genome_fasta" type="data" format="fasta" label="Source FASTA Sequence"/>
            </when>
        </conditional>
    </xml>
    <xml name="gff3_input">
        <param label="GFF3 Annotations" name="gff3_data" type="data" format="gff3"/>
    </xml>
    <xml name="input/gff3+fasta">
        <expand macro="gff3_input"/>
        <expand macro="genome_selector"/>
    </xml>
    <token name="@INPUT_GFF@">
	"$gff3_data"
	</token>
    <token name="@INPUT_FASTA@">
#if str($reference_genome.reference_genome_source) == 'cached':
		"${reference_genome.fasta_indexes.fields.path}"
#else if str($reference_genome.reference_genome_source) == 'history':
		genomeref.fa
#end if
	</token>
    <token name="@GENOME_SELECTOR_PRE@">
#if $reference_genome.reference_genome_source == 'history':
		ln -s $reference_genome.genome_fasta genomeref.fa;
#end if
	</token>
    <token name="@GENOME_SELECTOR@">
#if str($reference_genome.reference_genome_source) == 'cached':
		"${reference_genome.fasta_indexes.fields.path}"
#else if str($reference_genome.reference_genome_source) == 'history':
		genomeref.fa
#end if
	</token>
    <xml name="input/fasta">
        <param label="Fasta file" name="sequences" type="data" format="fasta"/>
    </xml>
    <token name="@SEQUENCE@">
		"$sequences"
	</token>
    <xml name="input/fasta/protein">
        <param label="Protein fasta file" name="sequences" type="data" format="fasta"/>
    </xml>
</macros>
